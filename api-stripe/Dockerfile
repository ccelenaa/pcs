# This file has been generated by @core/node:service-toolchain generator
# It should not be edited manually

# Test stage

ARG BUILDER_IMAGE
ARG RUNTIME_IMAGE

FROM ${BUILDER_IMAGE} AS builder

ARG PROJECT_ROOT

WORKDIR ${PROJECT_ROOT}

COPY package.json package-lock.json ${PROJECT_ROOT}/

RUN npm install

ADD . .


ARG cache=1

RUN npm test

RUN npm prune --production

# Build stage

FROM ${RUNTIME_IMAGE}

ARG PROJECT_ROOT

WORKDIR ${PROJECT_ROOT}

COPY package.json package.json

COPY --from=builder $PROJECT_ROOT/lib lib
COPY --from=builder $PROJECT_ROOT/node_modules node_modules

ENV NODE_CONFIG_DIR ${PROJECT_ROOT}/config

CMD ["npm", "start"]
